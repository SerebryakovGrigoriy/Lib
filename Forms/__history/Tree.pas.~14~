unit Tree;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Spring.Container, CustomInterfaces;

type
  TFormTree = class(TForm, ITreeFormInterface)
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
  private
    { Private declarations }
  protected
   FRefCount: Integer;
   function _AddRef: Integer; stdcall;
   function _Release: Integer; stdcall;
  public
    { Public declarations }
  function GetTreeForm: TForm;
  end;

var
  FormTree: TFormTree;

implementation

{$R *.dfm}

function TFormTree._AddRef: Integer;
begin
  Result := InterlockedIncrement(FRefCount);
end;

function TFormTree._Release: Integer;
begin
  Result := InterlockedDecrement(FRefCount);
  if Result<=0 then
    Self.Free;
end;

procedure TFormTree.FormClose(Sender: TObject; var Action: TCloseAction);
begin
   Self._Release;
end;

function TFormTree.GetTreeForm: TForm;
begin
  Result:= Self;
end;

end.
